NATIVE_ENABLED = false
BYTE_ENABLED = true

USE_OCAMLFIND = true

OCAMLFLAGS += -thread -syntax camlp4o
OCAMLDEPFLAGS += -syntax camlp4o

OCAMLPACKS[] =
    batteries
    str
    pgocaml
    pgocaml.syntax
    magic
    fileutils

SOURCES_BATCH[] =
    db
    batch

SOURCES_ADD[] =
    msort
    dir
    db
    add

#OCamlProgram($(BIN)/ts-batch, $(SOURCES_BATCH))
OCamlProgram($(BIN)/ts-add, $(SOURCES_ADD))

$(BIN)/ts: ts-template.sh
    sed "s:__ROOT__:$(shell realpath $(ROOT)):" ts-template.sh > $(BIN)/ts
    chmod(755, $(BIN)/ts)

.PHONY: bin: $(BIN)/ts $(BIN)/ts-add

.DEFAULT: bin

.PHONY: clean:
	rm -f *.cm?